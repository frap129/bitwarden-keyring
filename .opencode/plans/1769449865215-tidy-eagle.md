# Fix: User Cancellation Not Triggering Fallback Prevention

## Summary of Changes

All changes are necessary and already minimal. Here's what each change does:

### Go Side

**`internal/bitwarden/session.go`**
- `ErrUserCancelled` error - unified cancellation signal
- `isUserCancelled()` - detects exit code 1 (cancel) or 5 (timeout)
- `commandExists()` - checks command availability before running
- All prompt methods return `ErrUserCancelled` on cancel
- `PromptForPassword()` stops immediately on cancellation

**`internal/noctalia/client.go`**
- Treat `io.EOF` as `ErrCancelled` (connection closed = user cancelled)

### Plugin Side

**`noctalia-plugin/Main.qml`**
- **Root cause fix**: Added `id: clientSocket` to Socket handler
- Changed `this.parent` â†’ `clientSocket` (fixes undefined connection bug)
- `requestClose()` always closes connection and clears state

**`noctalia-plugin/AuthDialog.qml`**
- Removed `if (!busy)` check - X button should always work

**`noctalia-plugin/Panel.qml`**
- Added fallback to `closePanel()` if `pluginMain` is null (defensive)

## Changes Already Minimal

All changes are essential:
1. **Go cancellation handling** - Required to prevent fallback prompts
2. **EOF handling** - Required to detect window close as cancellation
3. **Socket reference fix** - Root cause of the bug (`this.parent` was undefined)
4. **X button fix** - Required so X always works regardless of busy state
5. **Panel fallback** - Defensive programming, prevents future issues

No simplification needed - the changes are already focused and minimal.
